# kaede.js シンプル版への置き換え完了

## 実施内容

### 1. ファイル操作
- ✅ `kaede.js` をシンプル版に直接置き換え（57,867 → 13,434 bytes）
- ✅ 元のバージョンを `kaede.backup.js` に保存（バックアップ）
- ✅ `kaede-simplified.js` は作成しない（指示通り）

### 2. kaede.js の主な変更点

#### 削除された要素
- 初回訪問フェーズの長大なプロンプト（105～299行）→ 削除
- 複雑な通常鑑定プロンプト（420～750行）→ シンプル化
- 冗長な心理分析テクニック解説 → 削除
- 無意識パターン・深層心理説明 → 削除
- 宗教的神秘性の詳細記述 → 削除
- 複雑なゲストユーザーフェーズ管理 → シンプル化

#### 新規実装
- **シンプルなプロンプト構造**（約13KB）
  - 守護神データベース（変更なし）
  - 通常鑑定フェーズ用プロンプト（簡潔版）
  - ゲスト・初期段階用プロンプト（簡潔版）
  - 基本キャラクターガイド

- **明確な応答方法**
  1. 相談者の心を読む
  2. 魂のレベルで語る
  3. 神秘的な雰囲気を演出
  4. 運命は変えられることを示す

- **文字数制限の明記**
  - ウェルカムメッセージ：300～400字程度
  - 通常返答：300～500字程度
  - 守護神の言葉受け取り後：400～600字程度

### 3. 期待される改善

#### 文字数制限問題の解決
| 項目 | 前 | 後 |
|------|-----|------|
| ファイルサイズ | 57KB | 13KB |
| システムプロンプト行数 | 1168行 | 約250行 |
| プロンプトトークン消費 | ~2000+ | ~600-800 |
| 実応答用トークン余裕 | 不足 | 充分 |

#### ウェルカムメッセージの改善
- 途中で途切れる問題が解決される
- 300～400字の完全なメッセージが生成可能
- 質の低下なし（シンプル化により可読性向上）

### 4. 後方互換性
すべてのエクスポート関数は変更なし：
```javascript
✅ generateKaedePrompt()
✅ determineGuardian()
✅ getGuardianData()
✅ getAllGuardianData()
✅ generateGuardianFirstMessagePrompt()
✅ generateKaedeFollowUpPrompt()
```

呼び出し側（character-system.js、generate-welcome.ts）の修正は不要です。

### 5. バックアップの位置
- `functions/_lib/characters/kaede.backup.js` に元の完全版を保存
- 必要に応じて復旧可能

## 次のステップ（オプション）

1. **テスト**: ウェルカムメッセージが正常に生成されるか確認
2. **微調整**: 必要に応じてプロンプトを調整
3. **モニタリング**: ユーザーのフィードバックを監視
4. **バックアップ削除**: 問題がないことを確認後、kaede.backup.js を削除
