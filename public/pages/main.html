<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運命を変える4人の鑑定士</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="main-page">
    <header class="main-header">
        <img src="../photo/rogo.png" alt="ロゴ" class="logo">
        <h1>運命を変える4人の鑑定士</h1>
    </header>

    <main>
        <div class="fortune-tellers-grid">
            <!-- 楓 -->
            <div class="fortune-teller-card">
                <img src="../photo/kaede.png" alt="楓" class="fortune-teller-photo">
                <h2>楓（かえで）</h2>
                <p>静かな日常を何より大切にしながら、必要な人にだけ力を向ける鑑定士。14歳で霊的な感受性に気づき、30代後半から相談に応じるようになる。派手さよりも誠実さ。目の前の一人が自力で立ち上がれるよう伴走する。</p>
                <a href="profiles/kaede.html" class="consult-button">楓を選ぶ</a>
            </div>

            <!-- 三崎花音 -->
            <div class="fortune-teller-card">
                <img src="../photo/kaon.png" alt="三崎花音" class="fortune-teller-photo">
                <h2>三崎花音（みさき かおん）</h2>
                <p>ユタの系譜に生まれ、幼少期から研鑽を重ねる。未来の"流れ"を読み、人の心の結び目をほどくことを得意とする。倫理を最優先に、誰かを不幸にしてまで叶える願いは扱わない。</p>
                <a href="profiles/kaon.html" class="consult-button">三崎花音を選ぶ</a>
            </div>

            <!-- 笹岡雪乃 -->
            <div class="fortune-teller-card">
                <img src="../photo/yukino.png" alt="笹岡雪乃" class="fortune-teller-photo">
                <h2>笹岡雪乃（ささおか ゆきの）</h2>
                <p>心理学とタロットを融合させた独自の鑑定スタイル。ヨーロッパでタロットを学び、心の奥底にある本当の願いを引き出す。相談者の無意識に寄り添い、自分らしい選択をサポートする。</p>
                <a href="profiles/yukino.html" class="consult-button">笹岡雪乃を選ぶ</a>
            </div>

            <!-- 水野ソラ -->
            <div class="fortune-teller-card">
                <img src="../photo/sora.png" alt="水野ソラ" class="fortune-teller-photo">
                <h2>水野ソラ（みずの そら）</h2>
                <p>他者の心の動きに敏感で、鍛錬を重ねる中で"前に進むための視点の切り替え"を支援するスタイルに到達。等身大の言葉で、必要な一歩に光を当てる。</p>
                <a href="profiles/sora.html" class="consult-button">水野ソラを選ぶ</a>
            </div>
        </div>
    </main>

    <script>
        // #region agent log (開発環境のみ - コメントアウト)
        // if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        //     fetch('http://127.0.0.1:7242/ingest/a12743d9-c317-4acb-a94d-a526630eb213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'main.html:52',message:'ページ読み込み完了',data:{url:window.location.href,userAgent:navigator.userAgent},timestamp:Date.now(),runId:'run1',hypothesisId:'B'})}).catch(()=>{});
        // }
        // #endregion
        
        // 【追加】URLパラメータからuserIdを取得して、プロフィールページへのリンクに追加
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');
        
        if (userId) {
            // すべてのプロフィールページへのリンクにuserIdを追加
            document.querySelectorAll('.consult-button').forEach((btn) => {
                const href = btn.getAttribute('href');
                if (href && href.startsWith('profiles/')) {
                    // 現在のページのパスを基準に相対パスを解決
                    // window.location.pathname = '/pages/main' または '/pages/main.html'
                    const currentPath = window.location.pathname;
                    const basePath = currentPath.substring(0, currentPath.lastIndexOf('/')); // '/pages'
                    const absolutePath = basePath + '/' + href; // '/pages/profiles/kaede.html'
                    const url = new URL(absolutePath, window.location.origin);
                    url.searchParams.set('userId', userId);
                    btn.href = url.pathname + url.search;
                    console.log('[main] プロフィールページへのリンクにuserIdを追加:', btn.href);
                }
            });
        }
        
        // スクロール時のアニメーション強化
        const cards = document.querySelectorAll('.fortune-teller-card');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animationPlayState = 'running';
                }
            });
        }, { threshold: 0.1 });

        cards.forEach(card => observer.observe(card));
        
        // #region agent log (開発環境のみ - コメントアウト)
        // document.querySelectorAll('.consult-button').forEach((btn, idx) => {
        //     btn.addEventListener('click', (e) => {
        //         if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        //             fetch('http://127.0.0.1:7242/ingest/a12743d9-c317-4acb-a94d-a526630eb213',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'main.html:click',message:'鑑定士選択ボタンクリック',data:{href:btn.href,text:btn.textContent,index:idx},timestamp:Date.now(),runId:'run1',hypothesisId:'C'})}).catch(()=>{});
        //         }
        //     });
        // });
        // #endregion
    </script>
</body>
</html>

