<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åˆè¨€è‘‰ã®ã”æ¡ˆå†… - é‹å‘½ã®æ‰‰</title>
  <style>
    :root {
      --bg1: #0a0a0f;
      --bg2: #1a0a2e;
      --accent: #8a2be2;
      --accent2: #5b2ea6;
      --text: #f5f1ff;
      --muted: #cbbdff;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 800px at 50% 0%, rgba(138,43,226,0.12), transparent),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px 16px;
    }
    .card {
      width: min(820px, 96vw);
      background: rgba(20, 12, 40, 0.8);
      border: 1px solid rgba(138, 43, 226, 0.35);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.45), inset 0 0 60px rgba(138,43,226,0.08);
      overflow: hidden;
      backdrop-filter: blur(6px);
      animation: fadeIn 600ms ease-out;
    }
    .header {
      padding: 20px 24px;
      background: linear-gradient(135deg, rgba(138,43,226,0.2), rgba(91,46,166,0.15));
      border-bottom: 1px solid rgba(138, 43, 226, 0.25);
    }
    .header h1 { margin: 0; font-size: 22px; letter-spacing: .04em; }
    .content { padding: 24px; }
    .lead { color: var(--muted); margin: 0 0 16px; line-height: 1.7; }

    .passphrase-wrap {
      margin: 18px 0 8px;
      display: grid;
      place-items: center;
    }
    .passphrase {
      font-size: clamp(22px, 5vw, 42px);
      line-height: 1.3;
      font-weight: 800;
      letter-spacing: .04em;
      color: #fff;
      text-align: center;
      padding: 18px 24px;
      border-radius: 14px;
      background: radial-gradient(600px 200px at 50% 0%, rgba(255,255,255,0.08), transparent),
                  linear-gradient(135deg, rgba(138,43,226,0.25), rgba(91,46,166,0.25));
      border: 1px solid rgba(138,43,226,0.35);
      text-shadow: 0 2px 10px rgba(0,0,0,0.25);
      transform: translateY(8px);
      opacity: 0;
      animation: popIn 900ms cubic-bezier(.2,.8,.2,1) 200ms forwards;
      position: relative;
    }
    .passphrase::after{
      content: '';
      position: absolute; inset: 0;
      border-radius: 14px;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.05) inset;
      pointer-events: none;
    }

    .note {
      margin-top: 12px;
      color: #ffd4d4;
      font-size: 14px;
      text-align: center;
    }

    .actions {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 20px;
    }
    @media (min-width: 560px) {
      .actions { grid-template-columns: 1fr 1fr; }
    }
    .btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(138, 43, 226, 0.3);
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff;
      font-weight: 700;
      letter-spacing: .04em;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(138,43,226,0.25);
      transition: transform .15s ease, box-shadow .15s ease, opacity .2s;
    }
    .btn.secondary {
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-color: rgba(255,255,255,0.18);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 16px 30px rgba(138,43,226,0.35); }

    .meta { margin-top: 12px; color: #c9c2e3; font-size: 13px; text-align: center; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: none; }
    }
    @keyframes popIn {
      0% { opacity: 0; transform: translateY(12px) scale(.98); filter: blur(6px);}
      60% { opacity: .9; transform: translateY(-2px) scale(1.01);} 
      100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0);} 
    }
  </style>
</head>
<body>
  <div class="card" role="dialog" aria-labelledby="title" aria-describedby="desc">
    <div class="header">
      <h1 id="title">ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</h1>
    </div>
    <div class="content">
      <p id="desc" class="lead">ã‚ãªãŸã‚’å°ãå¤§åˆ‡ãªåˆè¨€è‘‰ãŒæ±ºã¾ã‚Šã¾ã—ãŸã€‚<br>ã“ã®è¨€è‘‰ã¯ãƒ­ã‚°ã‚¤ãƒ³ã«å¿…è¦ã§ã™ã€‚<strong>å¿…ãšæ§ãˆã¦</strong>ã€<strong>çµ¶å¯¾ã«å¿˜ã‚Œãªã„ã‚ˆã†ã«</strong>ã—ã¦ãã ã•ã„ã€‚</p>

      <div class="passphrase-wrap">
        <div id="passphrase" class="passphrase" aria-live="assertive">â€¦</div>
      </div>
      <div class="note">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹ã‹ã€ã€Œã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>

      <div class="actions">
        <button id="copyBtn" class="btn" type="button">ğŸ“‹ åˆè¨€è‘‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜</button>
        <button id="continueBtn" class="btn secondary" type="button">ç¶šã‘ã‚‹ï¼ˆå…ƒã®ç”»é¢ã¸æˆ»ã‚‹ï¼‰</button>
      </div>

      <div id="copiedMsg" class="meta" style="opacity:.85; display:none;">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚å®‰å…¨ãªå ´æ‰€ã¸ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</div>
    </div>
  </div>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      const passphraseFromQuery = params.get('passphrase');
      const nickname = params.get('nickname') || localStorage.getItem('userNickname') || '';
      const redirect = params.get('redirect') || document.referrer || '/';

      const passEl = document.getElementById('passphrase');
      const copyBtn = document.getElementById('copyBtn');
      const copiedMsg = document.getElementById('copiedMsg');
      const continueBtn = document.getElementById('continueBtn');

      const localPass = localStorage.getItem('assignedDeity') || '';
      const passphrase = (passphraseFromQuery || localPass || '').toString();

      if (!passphrase) {
        passEl.textContent = 'ï¼ˆåˆè¨€è‘‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼‰';
      } else {
        // Type-like reveal
        passEl.textContent = '';
        const chars = Array.from(passphrase);
        let i = 0;
        const tick = () => {
          if (i < chars.length) {
            passEl.textContent += chars[i++];
            setTimeout(tick, 60);
          }
        };
        setTimeout(tick, 280);
      }

      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(passphrase);
          copiedMsg.style.display = 'block';
          copiedMsg.style.opacity = '1';
          setTimeout(()=>{ copiedMsg.style.opacity='0.85'; }, 100);
        } catch(e) {
          copiedMsg.textContent = 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚';
          copiedMsg.style.display = 'block';
        }
      });

      continueBtn.addEventListener('click', () => {
        if (redirect) {
          location.href = redirect;
        } else {
          history.length > 1 ? history.back() : location.href = '/';
        }
      });
    })();
  </script>
</body>
</html>
