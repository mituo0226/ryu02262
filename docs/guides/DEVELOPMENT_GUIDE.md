# 開発ガイド - 修正前に必ず確認

## ⚠️ 重要：どこで作業していますか？

修正を加える前に、必ず以下を確認してください：

### 1. サーバーの動作ディレクトリを確認

```powershell
# ターミナルで現在のディレクトリを確認
Get-Location

# 期待される場所：
# C:\Users\mituo\Desktop\kaede
```

**⚠️ 注意：ワークツリー (`C:\Users\mituo\.cursor\worktrees\kaede\*`) で作業しないこと！**

ワークツリーで修正しても、実際のサーバーには反映されません。

---

## 📂 ファイルの役割と責任範囲

### バックエンド（AIの振る舞い・プロンプト）

**場所**: `functions\_lib\characters\*.js`

**役割**:
- 鑑定士の性格設定
- 話し方・口調
- 鑑定内容の方針
- AIが生成するメッセージの内容

**例**:
- `yukino.js` - 笹岡雪乃のAIプロンプト
  - 「次は現在のカードをめくってみましょうね」という**フレーズ**
  - タロット占いの**解説内容**
  - まとめ鑑定の**話し方**

**修正が必要な場合**:
- AIの返答が間違っている
- 話し方を変更したい
- 鑑定の内容を変更したい

---

### フロントエンド（UI・カード表示・動作）

**場所**: `public\js\features\*.js`

**役割**:
- カードの画像表示
- ボタンの表示・動作
- AIの返答を解析（キーワード検出）
- 画面遷移のロジック

**例**:
- `yukino-tarot.js` - タロットカードのUI
  - カードをめくるアニメーション
  - 「次のカードを見る」ボタンの表示
  - AIの返答から「次は現在のカード」というキーワードを検出
  - sessionStorage でカード情報を管理

**修正が必要な場合**:
- ボタンが表示されない
- カードがめくれない
- AIの返答を正しく検出できていない
- アニメーションがおかしい

---

## 🔍 問題が起きたときの診断フロー

### ステップ1: 問題を特定

```
問題の種類は？
├─ AIの返答内容がおかしい
│  └─ → バックエンド (functions\_lib\characters\*.js)
│
├─ ボタンが表示されない / 動作しない
│  └─ → フロントエンド (public\js\features\*.js)
│
└─ AIの返答は正しいが、画面が正しく動かない
   └─ → フロントエンド (public\js\features\*.js)
```

### ステップ2: ログで確認

**ブラウザのコンソール**を開いて、以下を確認：

1. AIの返答内容（全文）
2. 検出されたキーワード
3. sessionStorage の状態

### ステップ3: 適切なファイルを修正

- バックエンド → `functions\_lib\characters\*.js`
- フロントエンド → `public\js\features\*.js`

---

## ✅ 修正前のチェックリスト

- [ ] サーバーの動作ディレクトリを確認した (`C:\Users\mituo\Desktop\kaede`)
- [ ] ワークツリーではなく、メインリポジトリで作業している
- [ ] 問題がバックエンドかフロントエンドか特定した
- [ ] ブラウザのコンソールでログを確認した
- [ ] 修正後、ブラウザでハードリロード (`Ctrl + Shift + R`) する

---

## 🎯 今回の問題（参考）

**問題**: 未来のカードが連続で出現する

**原因調査**:
1. ブラウザのコンソールでAIの返答を確認
2. AIが「次は未来のカード」と言っているか、「3枚のカードから見えてきた」と言っているか
3. → AIが間違っている場合: バックエンド修正
4. → AIは正しいが検出できていない場合: フロントエンド修正

**修正箇所**:
- バックエンド: `functions\_lib\characters\yukino.js`
- フロントエンド: `public\js\features\yukino-tarot.js`

---

## 📞 質問があれば

このガイドを参照しても解決しない場合は、以下を提供してください：

1. ブラウザのコンソールログ（特に🔍マークのログ）
2. どの操作で問題が発生したか
3. 期待される動作と実際の動作




