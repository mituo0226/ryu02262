# API テストページ使用ガイド

## 📋 概要

Cloudflare D1 データベースが正常に機能しているか確認するために、ゼロから作成した新しいテストページが利用可能です。

---

## 🚀 アクセス方法

### テストメニューページ（推奨）
```
http://localhost:8787/pages/test-menu.html
```

または、開発環境のドメイン経由でアクセス。

### 直接アクセス

**ユーザー登録テスト：**
```
http://localhost:8787/pages/test-register.html
```

**ユーザーログインテスト：**
```
http://localhost:8787/pages/test-db.html
```

---

## 🧪 テスト内容

### 1. ユーザー登録テスト (`test-register.html`)

**目的:** 新規ユーザーの登録機能が正常に機能するか確認

**テスト手順:**
1. ページにアクセス
2. ニックネーム、生年月日を入力（初期値が入っているので、そのまま使用可能）
3. 「登録テスト」ボタンをクリック
4. 結果を確認

**期待される結果:**
```json
{
  "userId": 123,
  "nickname": "テストユーザー",
  "message": "登録が完了しました。"
}
```

**ステータス表示:**
- ✅ 成功: 緑色で成功メッセージが表示
- ❌ 失敗: 赤色でエラーメッセージが表示
- ⏳ 処理中: グレーで処理中メッセージが表示

---

### 2. ユーザーログインテスト (`test-db.html`)

**目的:** ユーザーログイン機能が正常に機能するか確認

**テスト手順:**
1. ページにアクセス
2. Cloudflare D1 で確認したユーザーの情報を入力
   - 例: ニックネーム「光雄」、生年月日「1962年2月26日」
3. 「ログインテスト」ボタンをクリック
4. 結果を確認

**期待される結果:**
```json
{
  "userId": 132,
  "nickname": "光雄",
  "guardian": "大国主命"
}
```

**ステータス表示:**
- ✅ 成功: 緑色でユーザー情報が表示
- ❌ 失敗: 赤色でエラーメッセージが表示

---

## 🔍 トラブルシューティング

### 「Unexpected token '<'」エラーが表示される場合

**原因:** API がエラーレスポンス（HTML）を返している

**確認事項:**
1. ブラウザの開発者ツール（F12）を開く
2. ネットワークタブで API 呼び出しを確認
3. Response を見て、何が返されているか確認

**一般的な原因:**
- D1 データベース接続エラー
- 環境変数が未設定
- API ルーティングの問題

---

## ✅ テスト成功の条件

以下のすべてを満たしている場合、API は正常に機能しています：

1. **登録テスト**
   - ✅ ニックネーム・生年月日が入力できる
   - ✅ 「登録テスト」ボタンクリック後、緑色のメッセージが表示
   - ✅ `userId` が返される

2. **ログインテスト**
   - ✅ Cloudflare D1 に存在するユーザー情報で入力
   - ✅ 「ログインテスト」ボタンクリック後、緑色のメッセージが表示
   - ✅ `userId` と `nickname` が返される

3. **ダッシュボード動作確認**
   - ✅ ダッシュボードのユーザー検索が成功
   - ✅ ユーザー登録・ログインが動作

---

## 📊 結果報告

テストの結果を以下の形式で報告してください：

**登録テストの結果:**
```
✅ 成功 / ❌ 失敗
エラーメッセージ（失敗時のみ）:
```

**ログインテストの結果:**
```
✅ 成功 / ❌ 失敗
エラーメッセージ（失敗時のみ）:
```

---

## 🛠️ 開発者向け情報

### テストページの特徴

- **ゼロから作成**: 既存コードの影響がない
- **シンプル**: 最小限の機能で API テストに集中
- **デバッグ情報表示**: API レスポンスを JSON 形式で表示
- **ビジュアルフィードバック**: ステータスカラーで結果を即座に把握

### ファイル位置

```
public/pages/
├── test-menu.html          # テストメニュー
├── test-register.html      # 登録テスト
├── test-db.html            # ログインテスト
```

---

## 📝 備考

- テストページは開発・デバッグ用です
- 本番環境では使用しないでください
- テストで登録したユーザーは Cloudflare D1 に実際に保存されます

